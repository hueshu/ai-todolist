# 每日任务重置功能说明

## 功能概述

系统支持自动重置周期性任务（每日、每周、每月），确保这些任务能够在适当的时间重新出现在任务池中。

## 功能特性

### 1. 自动重置
- **每日任务**：每天自动重置前一天完成的每日任务
- **每周任务**：每周自动重置上周完成的任务
- **每月任务**：每月自动重置上月完成的任务

### 2. 历史记录保留
- 所有完成的周期性任务都会保存到 `task_completion_history` 表中
- 可用于后续的统计分析和报表生成

### 3. 手动重置
- 在任务池的"待处理"标签页中提供"重置周期任务"按钮
- 可手动触发重置流程

## 技术实现

### 数据库结构

1. **任务表字段**
   - `task_type`: 任务类型（single/daily/weekly/monthly）
   - `completed_at`: 完成时间
   - `status`: 任务状态

2. **任务完成历史表**
   ```sql
   task_completion_history:
   - id: 主键
   - task_id: 关联的任务ID
   - task_title: 任务标题
   - task_type: 任务类型
   - project_id: 项目ID（可选）
   - completed_at: 完成时间
   - estimated_hours: 预估时间
   - actual_hours: 实际时间（可选）
   - user_id: 用户ID
   - created_at: 记录创建时间
   ```

### 重置逻辑

1. **触发时机**
   - 应用启动时（loadAll方法）
   - 手动点击重置按钮

2. **重置规则**
   - 每日任务：完成时间不是今天的任务
   - 每周任务：完成时间超过7天的任务
   - 每月任务：完成时间不是本月的任务

3. **重置流程**
   1. 查询所有已完成的周期性任务
   2. 根据任务类型判断是否需要重置
   3. 创建完成历史记录
   4. 将任务状态重置为 'pool'
   5. 清除时间相关字段

## 使用方法

### 自动重置
无需任何操作，系统会在每次加载数据时自动检查并重置需要重置的任务。

### 手动重置
1. 进入任务池页面
2. 切换到"待处理"标签
3. 点击右上角的"重置周期任务"按钮
4. 确认操作后，系统会立即执行重置

## 注意事项

1. 重置操作会保留任务的基本信息（标题、项目、标签等）
2. 重置后的任务会回到任务池，需要重新安排到今日任务
3. 所有的完成记录都会保存，不会丢失历史数据
4. 单次任务（single）不会被重置

## 后续优化建议

1. 添加任务完成统计页面，展示历史完成情况
2. 支持自定义重置周期（如每3天、每2周等）
3. 添加任务完成提醒功能
4. 支持批量查看和导出历史记录